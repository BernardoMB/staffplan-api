<main class="main-container">
    <div class="hero-content">
        <div class="page-subtitle alert-column-dropdown-as-title">
            <kendo-dropdownlist [data]="listQuickViews" textField="text"
                                valueField="value" [(ngModel)]="selectedQuickView"
                                [popupSettings]="{popupClass: popupClassQuickView}"
                                style="width: 225px;"
                                (valueChange)="handleValueChange($event,'QUICK-VIEW')">
            </kendo-dropdownlist>
            <!--<span class="page-subtitle__status">{{assignStaffData.total}} Project</span>-->
        </div>
        <div class="filter-tag clearfix">
            <div class="filter-tag__wrapper">
                <span class="filter-tag__label"
                      *ngIf="viewDataByFilter.status || viewDataByFilter.group || viewDataByFilter.office">Viewing </span>
                <a class="btn filter-tag__item" *ngIf="viewDataByFilter.status"
                   (click)="model.status = null;onFilterSubmit(undefined);">{{viewDataByFilter.status['STATUS_NAME']}}<i
                        class="icon-filter-remove"></i></a>
                <a class="btn filter-tag__item" *ngIf="viewDataByFilter.office"
                   (click)="model.office = null;onFilterSubmit(undefined);">{{viewDataByFilter.office['OFFICE_NAME']}}<i
                        class="icon-filter-remove"></i></a>
                <a class="btn filter-tag__item" *ngIf="viewDataByFilter.group"
                   (click)="model.group = null;onFilterSubmit(undefined);">{{viewDataByFilter.group['GROUP_NAME']}}<i
                        class="icon-filter-remove"></i></a>
                <a class="btn filter-tag__item"
                   *ngIf="viewDataByFilter.status || viewDataByFilter.group || viewDataByFilter.office"
                   (click)="onClearFilter()">Reset of All <i
                        class="icon-filter-remove"></i></a>
            </div>
            <div class="filter__right  k-toolbar__has-one-btn">
                <div class="custom-dropdown align-middle" *ngIf="selectedQuickView['value'] !== 'OVER_ALLOC'">
                    <div *ngIf="selectedQuickView['value'] !== 'NEXT_90_DAY'">
                        <kendo-dropdownbutton [popupSettings]="{popupClass: popupClass}" [data]="futureColumnListGrouping"
                                            (itemClick)="onGroupByColumnSelect($event)">
                            Group
                        </kendo-dropdownbutton>
                    </div>
                </div>
                <div class="search-wrap">
                    <div class="search-wrap__inner">
                        <kendo-autocomplete
                                [data]="typeAheadSuggestions"
                                [filterable]="true"
                                id="search"
                                (valueChange)="getListByValueChange($event)"
                                (filterChange)="getListByFilterChange($event)"
                                [placeholder]="'Search'"
                                [ngModel]="filterValue" class="form-control">
                        </kendo-autocomplete>
                    </div>
                </div><!-- /.search-wrap-->

                <div class="filter__btn">
                    <div class="dropdown">
                        <button class="btn btn-light-gray is-filtered" type="button" id="dropdownFilter"
                                data-toggle="dropdown" (click)="filterMenuOpen = true" aria-haspopup="true"
                                aria-expanded="false" data-offset="0,20">
                            <i class="icon-filter"></i>
                        </button>
                        <div [hidden]="!filterMenuOpen" [ngClass]="filterMenuOpen ? 'show':''"
                             class=" dropdown-menu--white dropdown-menu dropdown-menu-right"
                             aria-labelledby="dropdownFilter">
                            <form name="form" #projectFilterForm="ngForm">
                                <div class="form-group">
                                    <label for="status">Staff Status</label>
                                    <kendo-dropdownlist
                                            [data]="filteredStaffStatusList"
                                            [textField]="'STATUS_NAME'"
                                            [valueField]="'STATUS_NAME'"
                                            [filterable]="true"
                                            name="status"
                                            id="status"
                                            class="form-control form-control--gray"
                                            #status="ngModel"
                                            [(ngModel)]="model.status"
                                            (filterChange)="handleFilterChange($event, 'STAFF_STATUS')">

                                    </kendo-dropdownlist>
                                </div>
                                <div class="form-group">
                                    <label for="group">Office</label>
                                    <kendo-dropdownlist
                                            [data]="filteredOfficeList"
                                            [textField]="'OFFICE_NAME'"
                                            [valueField]="'OFFICE_ID'"
                                            [filterable]="true"
                                            name="office"
                                            id="assProjectCity"
                                            class="form-control form-control--gray"
                                            #office="ngModel"
                                            placeholder="select office.."
                                            [(ngModel)]="model.office"
                                            (filterChange)="handleFilterChange($event, 'OFFICE')">

                                    </kendo-dropdownlist>
                                </div>
                                <div class="form-group">
                                    <label for="group">Type of Staff</label>
                                    <kendo-dropdownlist
                                            [data]="filteredStaffGroupList"
                                            [textField]="'GROUP_NAME'"
                                            [valueField]="'GROUP_NAME'"
                                            [filterable]="true"
                                            name="group"
                                            id="group"
                                            class="form-control form-control--gray"
                                            #group="ngModel"
                                            [(ngModel)]="model.group"
                                            (filterChange)="handleFilterChange($event, 'STAFF_GROUP')">
                                    </kendo-dropdownlist>
                                </div>
                                <div class="d-flex">
                                    <button class="btn btn-blue w-50 mr-1" title="Apply"
                                            (click)="onFilterSubmit('removeSearch')">Apply
                                    </button>
                                    <button class="btn btn-light-gray w-50 ml-1" title="Clear All"
                                            (click)="onClearFilter()">Clear All
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

            </div><!-- /.filter__right -->
        </div><!-- /.filter-tag -->
        <div class="table-responsive hide-scroll">
            <table class="table table--default td-overflow-visible" id="print-section"
                   *ngIf="selectedQuickView['value'] == 'NEXT_90_DAY'|| selectedQuickView['value'] =='UPCOM_ROLL_OFF'">
                <kendo-grid
                        class="position-static"
                        [data]="assignStaffData"
                        [loading]="showLoader"
                        [sortable]="true"
                        [selectable]="true"
                        [sort]="config.sort"
                        [navigable]="true"
                        (dataStateChange)="dataStateChange($event)"
                        [resizable]="true">
                    <ng-template kendoGridToolbarTemplate>
                        <button kendoGridPDFCommand class="btn btn-light-gray"><i class="icon-download"></i></button>
                        <button kendoGridExcelCommand class="btn btn-light-gray" type="button"><i
                                class="icon-excel"></i></button>
                    </ng-template>
                    <ng-template kendoGridNoRecordsTemplate>
                        <span *ngIf="!showLoader"> No records available. </span>
                    </ng-template>
                    <kendo-grid-column width="100">
                        <ng-template kendoGridCellTemplate let-dataItem="dataItem">
                            <div class="dropdown-project-modify">
                                <div class="dropdown">
                                    <button class="btn" type="button" id="dropdownProject3" data-toggle="dropdown"
                                            aria-haspopup="true" aria-expanded="false" data-offset="-20,15">
                                        <i class="icon-three-dot"></i>
                                    </button>
                                    <div class="dropdown-menu dropdown-menu--white" aria-labelledby="dropdownProject3">
                                        <ul class="staff-modify__list">
                                            <li class="project-team-modify__item">
                                                <a (click)="openVerticallyCenteredAssignProject(assignContent,dataItem)"
                                                   title="Project Team: Assign or Edit Staff on Project">
                                                    Assign Project<span class="text-label">Assign or Edit Staff on Project</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </ng-template>
                    </kendo-grid-column>
                    <kendo-grid-column
                            field="{{column.columnId}}"
                            title="{{column.columnLabel}}"
                            *ngFor="let column of allColumns">
                        <ng-template kendoGridCellTemplate let-dataItem="dataItem"
                                     *ngIf="column.columnId == 'STAFF_NAME'">
                            <button type="button" class="btn btn-link btn-popover-link" container="body"
                                    placement="right-top"
                                    (click)="openVerticallyCenteredEditStaff(editContent,dataItem)"
                                    appHandlePopoverClose>
                                {{dataItem.STAFF_NAME}}
                            </button>
                        </ng-template>
                        <ng-template kendoGridCellTemplate let-dataItem="dataItem"
                                     *ngIf="column.columnId == 'PROJECT_NAME'">
                            <button type="button" class="btn btn-link btn-popover-link"
                                    (click)="openVerticallyCentered(content,dataItem,4)" container="body"
                                    placement="right-top" appHandlePopoverClose>
                                <span class="td-highlighted"> {{dataItem[column.columnId]}} </span>
                            </button>
                        </ng-template>
                        <ng-template kendoGridCellTemplate let-dataItem="dataItem"
                                     *ngIf="column.columnId == 'END_DATE'">
                            <span> {{dataItem[column.columnId]| date: date_format}} </span>
                        </ng-template>
                        <ng-template kendoGridCellTemplate let-dataItem="dataItem"
                                     *ngIf="column.columnId == 'NEXT_AVAILABLE'">
                            <!-- <span> {{dataItem[column.columnId]| date: date_format}} </span> -->
                        </ng-template>

                    </kendo-grid-column>
                    <kendo-grid-pdf fileName="FutureDays.pdf" [scale]="0.8" [repeatHeaders]="true">
                        <kendo-grid-pdf-margin top="1cm" left="1cm" right="1cm" bottom="1cm"></kendo-grid-pdf-margin>
                    </kendo-grid-pdf>
                    <kendo-grid-excel fileName="NextAvailable.xlsx" [fetchData]="allData"></kendo-grid-excel>

                </kendo-grid>
            </table>
            <table class="table table--default td-overflow-visible" *ngIf="selectedQuickView['value'] == 'NEW_STAFF'">
                <kendo-grid [data]="newStaffData"
                            [loading]="showLoader"
                            class="word-wrap position-static"
                            [sortable]="true"
                            [sort]="config.sort"
                            [resizable]="true"
                            [reorderable]="true"
                            [selectable]="true"
                            (dataStateChange)="dataStateChange($event)">
                    <ng-template kendoGridToolbarTemplate>
                        <button kendoGridPDFCommand class="btn btn-light-gray"><i class="icon-download"></i></button>
                        <button kendoGridExcelCommand class="btn btn-light-gray" type="button"><i
                                class="icon-excel"></i></button>
                    </ng-template>
                    <ng-template kendoGridNoRecordsTemplate>
                        <span *ngIf="!showLoader"> No records available. </span>
                    </ng-template>
                    <kendo-grid-column width="100">
                        <ng-template kendoGridCellTemplate let-dataItem="dataItem">
                            <div class="dropdown-project-modify">
                                <div class="dropdown">
                                    <button class="btn" type="button" id="dropdownProject1" data-toggle="dropdown"
                                            aria-haspopup="true" aria-expanded="false" data-offset="-20,15">
                                        <i class="icon-three-dot"></i>
                                    </button>
                                    <div class="dropdown-menu dropdown-menu--white" aria-labelledby="dropdownProject1">
                                        <ul class="staff-modify__list">
                                            <li class="staff-modify__item">
                                                <a (click)="openVerticallyCenteredEditStaff(editContent,dataItem)"
                                                   title="Project Team: Assign or Edit Staff on Project">
                                                    Staff Detail<span
                                                        class="text-label">View and Update Staff</span>
                                                </a>
                                            </li>
                                            <li class="staff-modify__item">
                                                <a (click)="openVerticallyCenteredNewStaffAssignProject(newStaffAssignContent,dataItem)"
                                                   title="Project Team: Assign or Edit Staff on Project">
                                                    Assign Project<span
                                                        class="text-label">Assign or Edit Staff on Project</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </ng-template>
                    </kendo-grid-column>
                    <kendo-grid-column field="{{column.columnId}}" title="{{column.columnLabel}}" width="150"
                                       *ngFor="let column of allColumns">
                        <ng-template kendoGridCellTemplate let-dataItem="dataItem"
                                     *ngIf="column.columnId == 'PREFERRED_NAME'">
                            <button type="button" class="btn btn-link btn-popover-link" container="body"
                                    placement="right-top"
                                    (click)="openVerticallyCenteredEditStaff(editContent,dataItem)"
                                    appHandlePopoverClose>
                                <span class="td-highlighted" *ngIf="dataItem.PREFERRED_NAME != null && dataItem.PREFERRED_NAME != ''; else other_content"> {{dataItem.PREFERRED_NAME}} {{dataItem.LAST_NAME}}</span>
                                <ng-template #other_content><span class="td-highlighted"> {{dataItem.PREFERRED_NAME != null && dataItem.PREFERRED_NAME != '' ? dataItem.PREFERRED_NAME : dataItem.FIRST_NAME}} {{dataItem.LAST_NAME}}</span></ng-template>
                            </button>
                        </ng-template>
                    </kendo-grid-column>
                    <kendo-grid-pdf fileName="Staff.pdf" [scale]="0.8" [repeatHeaders]="true">
                        <kendo-grid-pdf-margin top="1cm" left="1cm" right="1cm" bottom="1cm"></kendo-grid-pdf-margin>
                    </kendo-grid-pdf>
                    <kendo-grid-excel fileName="Staff.xlsx" [fetchData]="allData"></kendo-grid-excel>
                </kendo-grid>
            </table>
            <table class="table table--default td-overflow-visible"
                   *ngIf="selectedQuickView['value'] == 'STAFF_GAP'||selectedQuickView['value'] == 'OVER_ALLOC'">
                <kendo-grid
                        [data]="staffAssignData"
                        [loading]="showLoader"
                        [sortable]="true"
                        [selectable]="true"
                        [sort]="config.sort"
                        [navigable]="true"
                        (dataStateChange)="dataStateChange($event)"
                        [resizable]="true"
                        class="word-wrap position-static">
                    <ng-template kendoGridToolbarTemplate>
                        <button kendoGridPDFCommand class="btn btn-light-gray"><i class="icon-download"></i></button>
                        <button kendoGridExcelCommand class="btn btn-light-gray" type="button"><i
                                class="icon-excel"></i></button>
                    </ng-template>
                    <ng-template kendoGridNoRecordsTemplate>
                        <span *ngIf="!showLoader"> No records available. </span>
                    </ng-template>
                    <kendo-grid-column width="100">
                        <ng-template kendoGridCellTemplate let-dataItem="dataItem">
                            <div class="dropdown-project-modify">
                                <div class="dropdown">
                                    <button class="btn" type="button" id="dropdownProject1" data-toggle="dropdown"
                                            aria-haspopup="true" aria-expanded="false" data-offset="-20,15">
                                        <i class="icon-three-dot"></i>
                                    </button>
                                    <div class="dropdown-menu dropdown-menu--white" aria-labelledby="dropdownProject1">
                                        <ul class="staff-modify__list">

                                            <li class="project-team-modify__item">
                                                <a (click)="openVerticallyCenteredAssignProject(assignContent,dataItem)"
                                                   title="Project Team: Assign or Edit Staff on Project">
                                                    Assign Project<span class="text-label">Assign or Edit Staff on Project</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </ng-template>
                    </kendo-grid-column>
                    <kendo-grid-column
                            field="{{column.columnId}}"
                            title="{{column.columnLabel}}"
                            *ngFor="let column of allColumns">
                        <ng-template kendoGridCellTemplate let-dataItem="dataItem"
                                     *ngIf="column.columnId == 'STAFF_NAME'">
                            <button type="button" *ngIf="dataItem.STAFF_NAME" class="btn btn-link btn-popover-link"
                                    container="body" placement="right-top"
                                    (click)="openVerticallyCenteredEditStaff(editContent,dataItem)"
                            >
                                {{dataItem.STAFF_NAME}}
                            </button>
                            <span *ngIf="!dataItem.STAFF_NAME" class="unassigned-staff">
                (Unassigned)
                </span>
                        </ng-template>
                        <ng-template kendoGridCellTemplate let-dataItem="dataItem"
                                     *ngIf="column.columnId == 'PROJECT_NAME'">
                            <button type="button" class="btn btn-link btn-popover-link"
                                    (click)="openVerticallyCentered(content,dataItem,4)" container="body"
                                    placement="right-top" appHandlePopoverClose>
                                <span class="td-highlighted"> {{dataItem[column.columnId]}} </span>
                            </button>
                        </ng-template>
                        <ng-template kendoGridCellTemplate let-dataItem="dataItem"
                                     *ngIf="column.columnId == 'START_DATE' || column.columnId == 'END_DATE'">
                            <span> {{dataItem[column.columnId]| date: date_format}} </span>
                        </ng-template>
                    </kendo-grid-column>
                    <kendo-grid-pdf fileName="StaffGap.pdf" [scale]="0.8" [repeatHeaders]="true">
                        <kendo-grid-pdf-margin top="1cm" left="1cm" right="1cm" bottom="1cm"></kendo-grid-pdf-margin>
                    </kendo-grid-pdf>
                    <kendo-grid-excel fileName="StaffGap.xlsx" [fetchData]="allData"></kendo-grid-excel>
                </kendo-grid>

            </table>
        </div>
    </div>
</main>
<ng-template #editContent>
    <app-staff-view-project-details-popover (childStaffCloseEvent)="childCloseEvent($event)"
                                            [staffIdForEditStaff]="staffIdForEditStaff">
    </app-staff-view-project-details-popover>
</ng-template>
<ng-template #assignContent>
    <app-assign-staff-popover [model]="editDataItem"
                              (assignStaffChildCloseEvent)="childCloseEvent($event)">
    </app-assign-staff-popover>
</ng-template>
<ng-template #content>
    <app-project-view-staff-detail-popover (childDeleteEvent)="childCloseEvent($event)"
                                           [projectInstance]="selectedProject" [renderTable]="renderTable"
                                           [addForm]="tabStatus">
    </app-project-view-staff-detail-popover>
</ng-template>

<ng-template #newStaffAssignContent>
    <app-assign-staff-popover [staffIdForEditStaff]="staffIdForEditStaff"
                              (assignStaffChildCloseEvent)="childCloseEvent($event)">
    </app-assign-staff-popover>
</ng-template>